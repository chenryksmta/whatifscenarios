<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operating Ratio Impact Calculator | FreightMath</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            min-height: 100vh;
            padding: 20px;
            font-size: 13px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo {
            max-width: 180px;
            margin-bottom: 8px;
        }

        h1 {
            color: #1a365d;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .subtitle {
            color: #64748b;
            font-size: 0.8rem;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 16px;
            align-items: start;
        }

        .controls-column {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .results-column {
            position: sticky;
            top: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
            padding: 16px;
        }

        .card-title {
            color: #1a365d;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }

        .slider-section {
            text-align: center;
            padding: 8px 0;
        }

        .slider-label {
            font-size: 0.75rem;
            color: #475569;
            margin-bottom: 6px;
        }

        .slider-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #0369a1;
            margin-bottom: 2px;
        }

        .slider-sublabel {
            font-size: 0.7rem;
            color: #94a3b8;
            margin-bottom: 12px;
        }

        .slider-container {
            position: relative;
            padding: 0 8px;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #0369a1 0%, #0369a1 var(--progress), #e2e8f0 var(--progress), #e2e8f0 100%);
            outline: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #0369a1;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(3, 105, 161, 0.4);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #0369a1;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(3, 105, 161, 0.4);
        }

        .slider-range {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
            font-size: 0.65rem;
            color: #64748b;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .metric-box {
            background: #f8fafc;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .metric-box.highlight {
            background: linear-gradient(135deg, #0369a1 0%, #0284c7 100%);
            border: none;
        }

        .metric-box.highlight .metric-label,
        .metric-box.highlight .metric-value {
            color: white;
        }

        .metric-box.improvement {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            border: none;
        }

        .metric-box.improvement .metric-label,
        .metric-box.improvement .metric-value {
            color: white;
        }

        .metric-label {
            font-size: 0.6rem;
            color: #64748b;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .metric-value {
            font-size: 1rem;
            font-weight: 700;
            color: #1a365d;
        }

        .metric-value.small {
            font-size: 0.9rem;
        }

        .comparison-section {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 12px;
        }

        .comparison-box {
            text-align: center;
            padding: 12px 8px;
            border-radius: 8px;
        }

        .comparison-box.current {
            background: #fef3c7;
            border: 2px solid #f59e0b;
        }

        .comparison-box.projected {
            background: #d1fae5;
            border: 2px solid #10b981;
        }

        .comparison-label {
            font-size: 0.65rem;
            color: #64748b;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .comparison-value {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .comparison-box.current .comparison-value {
            color: #b45309;
        }

        .comparison-box.projected .comparison-value {
            color: #059669;
        }

        .arrow {
            font-size: 1.2rem;
            color: #94a3b8;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .input-label {
            font-size: 0.65rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-weight: 500;
        }

        .currency-input {
            position: relative;
            display: flex;
            align-items: center;
        }

        .currency-input::before {
            content: "$";
            position: absolute;
            left: 8px;
            color: #64748b;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .currency-input input {
            width: 100%;
            padding: 8px 8px 8px 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #1a365d;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            background: #f8fafc;
            transition: all 0.2s;
        }

        .currency-input input:focus {
            outline: none;
            border-color: #0369a1;
            background: white;
            box-shadow: 0 0 0 2px rgba(3, 105, 161, 0.1);
        }

        .inputs-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 6px;
        }

        .input-hint {
            font-size: 0.6rem;
            color: #94a3b8;
            margin-top: 2px;
        }

        .current-profit-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }

        .profit-box {
            text-align: center;
            padding: 12px;
            border-radius: 6px;
        }

        .profit-box.loss {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        }

        .profit-box.profit {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }

        .profit-label {
            font-size: 0.65rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 4px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .profit-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: white;
        }

        .impact-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .results-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
            padding: 16px;
        }

        .results-title {
            color: #1a365d;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
            text-align: center;
        }

        .projected-profit-box {
            text-align: center;
            padding: 14px;
            border-radius: 8px;
            margin-top: 12px;
        }

        .projected-profit-box.loss {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        }

        .projected-profit-box.profit {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }

        .projected-profit-label {
            font-size: 0.65rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 4px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .projected-profit-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            padding: 4px 0;
        }

        .detail-label {
            color: #64748b;
        }

        .detail-value {
            color: #1a365d;
            font-weight: 600;
        }

        .detail-item.full-width {
            grid-column: span 2;
            border-top: 1px solid #e2e8f0;
            margin-top: 4px;
            padding-top: 8px;
        }

        .footer {
            text-align: center;
            margin-top: 16px;
            color: #94a3b8;
            font-size: 0.65rem;
        }

        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .results-column {
                position: static;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://info.ksmcpa.com/hubfs/FreightMath/Images/KSM_FM_Logo_RGB_Color.png" alt="KSM FreightMath Logo" class="logo">
            <h1>Operating Ratio Impact Calculator</h1>
            <p class="subtitle">See how operational improvements impact your profitability</p>
        </div>

        <div class="main-layout">
            <div class="controls-column">
                <div class="card">
                    <div class="card-title">Company Cost Inputs</div>
                    <div class="inputs-grid">
                        <div class="input-group">
                            <label class="input-label" for="overheadInput">Monthly Fixed Overhead</label>
                            <div class="currency-input">
                                <input type="text" id="overheadInput" value="695,581.83">
                            </div>
                            <div class="input-hint">Costs that don't change with fleet size</div>
                        </div>
                        <div class="input-group">
                            <label class="input-label" for="variableInput">Monthly Variable Cost</label>
                            <div class="currency-input">
                                <input type="text" id="variableInput" value="951,952.18">
                            </div>
                            <div class="input-hint">Costs that scale with seated tractors</div>
                        </div>
                    </div>
                    
                    <div class="current-profit-section">
                        <div class="profit-box loss" id="currentProfitBox">
                            <div class="profit-label">Current Monthly Profit / Loss</div>
                            <div class="profit-value" id="currentProfitLoss">-$479,388</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Increase Seated Tractors</div>
                    <div class="slider-section">
                        <div class="slider-label">Number of Seated Tractors</div>
                        <div class="slider-value" id="tractorCount">78</div>
                        <div class="slider-sublabel">of 108 total tractors (<span id="utilization">72.2</span>% utilization)</div>
                        <div class="slider-container">
                            <input type="range" id="tractorSlider" min="78" max="108" value="78">
                            <div class="slider-range">
                                <span>78 (Current)</span>
                                <span>108 (Full Fleet)</span>
                            </div>
                        </div>
                    </div>
                    <div class="impact-metrics">
                        <div class="metric-box">
                            <div class="metric-label">Additional Tractors</div>
                            <div class="metric-value" id="additionalTractors">+0</div>
                        </div>
                        <div class="metric-box highlight">
                            <div class="metric-label">Added Revenue</div>
                            <div class="metric-value small" id="tractorRevenue">$0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Improve Rates (Linehaul + FSC)</div>
                    <div class="slider-section">
                        <div class="slider-label">Rate per Mile</div>
                        <div class="slider-value" id="ratePerMileDisplay">$2.17</div>
                        <div class="slider-sublabel">Current: $2.17/mile on <span id="rateMilesDisplay">540,619</span> loaded miles</div>
                        <div class="slider-container">
                            <input type="range" id="ratesSlider" min="0" max="100" value="0" step="1">
                            <div class="slider-range">
                                <span>$2.17 (Current)</span>
                                <span>$2.45 (Target)</span>
                            </div>
                        </div>
                    </div>
                    <div class="impact-metrics">
                        <div class="metric-box">
                            <div class="metric-label">Rate Increase</div>
                            <div class="metric-value small" id="rateIncrease">+$0.00</div>
                        </div>
                        <div class="metric-box highlight">
                            <div class="metric-label">Added Revenue</div>
                            <div class="metric-value small" id="rateRevenue">$0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Reduce Empty Miles</div>
                    <div class="slider-section">
                        <div class="slider-label">Empty Miles Percentage</div>
                        <div class="slider-value" id="emptyMilesPercent">18%</div>
                        <div class="slider-sublabel">Current: 18% of <span id="totalMilesDisplay">540,619</span> total miles</div>
                        <div class="slider-container">
                            <input type="range" id="emptyMilesSlider" min="0" max="80" value="0" step="5">
                            <div class="slider-range">
                                <span>18% (Current)</span>
                                <span>10% (Target)</span>
                            </div>
                        </div>
                    </div>
                    <div class="impact-metrics">
                        <div class="metric-box">
                            <div class="metric-label">Miles Converted</div>
                            <div class="metric-value" id="milesConverted">0</div>
                        </div>
                        <div class="metric-box highlight">
                            <div class="metric-label">Added Revenue</div>
                            <div class="metric-value small" id="additionalRevenue">$0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Reduce Maintenance Cost</div>
                    <div class="slider-section">
                        <div class="slider-label">Maintenance Cost per Mile</div>
                        <div class="slider-value" id="maintPerMileDisplay">$0.40</div>
                        <div class="slider-sublabel">Current: $0.40/mile on <span id="maintMilesDisplay">540,619</span> total miles</div>
                        <div class="slider-container">
                            <input type="range" id="maintenanceSlider" min="0" max="100" value="0" step="1">
                            <div class="slider-range">
                                <span>$0.40 (Current)</span>
                                <span>$0.18 (Target)</span>
                            </div>
                        </div>
                    </div>
                    <div class="impact-metrics">
                        <div class="metric-box">
                            <div class="metric-label">Projected Maint Cost</div>
                            <div class="metric-value small" id="projectedMaintCost">$216,248</div>
                        </div>
                        <div class="metric-box highlight">
                            <div class="metric-label">Monthly Savings</div>
                            <div class="metric-value small" id="maintSavings">$0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Reduce Insurance Cost</div>
                    <div class="slider-section">
                        <div class="slider-label">Insurance Cost per Mile</div>
                        <div class="slider-value" id="insurancePerMileDisplay">$0.22</div>
                        <div class="slider-sublabel">Current: $0.22/mile on <span id="insuranceMilesDisplay">540,619</span> total miles</div>
                        <div class="slider-container">
                            <input type="range" id="insuranceSlider" min="0" max="100" value="0" step="1">
                            <div class="slider-range">
                                <span>$0.22 (Current)</span>
                                <span>$0.11 (Target)</span>
                            </div>
                        </div>
                    </div>
                    <div class="impact-metrics">
                        <div class="metric-box">
                            <div class="metric-label">Projected Insurance Cost</div>
                            <div class="metric-value small" id="projectedInsuranceCost">$118,936</div>
                        </div>
                        <div class="metric-box highlight">
                            <div class="metric-label">Monthly Savings</div>
                            <div class="metric-value small" id="insuranceSavings">$0</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="results-column">
                <div class="results-card">
                    <div class="results-title">Projected Results</div>
                    
                    <div class="comparison-section">
                        <div class="comparison-box current">
                            <div class="comparison-label">Current OR</div>
                            <div class="comparison-value" id="currentOR">141.0%</div>
                        </div>
                        <div class="arrow">â†’</div>
                        <div class="comparison-box projected">
                            <div class="comparison-label">Projected OR</div>
                            <div class="comparison-value" id="projectedOR">141.0%</div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-box highlight">
                            <div class="metric-label">OR Improvement</div>
                            <div class="metric-value" id="orImprovement">0.0 pts</div>
                        </div>
                        <div class="metric-box improvement">
                            <div class="metric-label">Profit Change</div>
                            <div class="metric-value" id="profitImpact">$0</div>
                        </div>
                    </div>

                    <div class="projected-profit-box loss" id="projectedProfitBox">
                        <div class="projected-profit-label">Projected Monthly Profit / Loss</div>
                        <div class="projected-profit-value" id="projectedProfit">-$479,388</div>
                    </div>

                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="detail-label">Projected Revenue</span>
                            <span class="detail-value" id="projectedRevenue">$1,168,146</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Projected Cost</span>
                            <span class="detail-value" id="projectedCost">$1,647,534</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Rev per Tractor</span>
                            <span class="detail-value" id="revenuePerTractor">$14,976</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Var Cost/Tractor</span>
                            <span class="detail-value" id="varCostPerTractor">$12,205</span>
                        </div>
                        <div class="detail-item full-width">
                            <span class="detail-label">Contribution Margin per Tractor</span>
                            <span class="detail-value" id="contributionMargin">$2,771</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>KSM Transport Advisors | FreightMath Analytics</p>
        </div>
    </div>

    <script>
        // Current company stats (defaults)
        const currentStats = {
            seatedTractors: 78,
            totalTractors: 108,
            monthlyRevenue: 1168146.40,
            overhead: 695581.83,
            variableCost: 951952.18,
            totalMiles: 540619.29,
            currentEmptyPercent: 18,
            targetEmptyPercent: 10,
            currentMaintPerMile: 0.40,
            targetMaintPerMile: 0.18,
            currentRatePerMile: 2.17,
            targetRatePerMile: 2.45,
            currentInsurancePerMile: 0.22,
            targetInsurancePerMile: 0.11
        };

        // Calculate revenue per mile (loaded miles only)
        const loadedMiles = currentStats.totalMiles * (1 - currentStats.currentEmptyPercent / 100);
        const revenuePerLoadedMile = currentStats.monthlyRevenue / loadedMiles;

        // Parse currency string to number
        function parseCurrency(str) {
            return parseFloat(str.replace(/[^0-9.-]/g, '')) || 0;
        }

        // Format number with commas
        function formatNumber(value) {
            return value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        // Format currency
        function formatCurrency(value) {
            const absValue = Math.abs(Math.round(value));
            const formatted = '$' + absValue.toLocaleString('en-US');
            return value < 0 ? '-' + formatted : formatted;
        }

        // Format currency with sign
        function formatCurrencyWithSign(value) {
            const absValue = Math.abs(Math.round(value));
            const formatted = '$' + absValue.toLocaleString('en-US');
            if (value > 0) return '+' + formatted;
            if (value < 0) return '-' + formatted;
            return formatted;
        }

        // Format percentage
        function formatPercent(value, decimals = 1) {
            return value.toFixed(decimals) + '%';
        }

        // Format miles
        function formatMiles(value) {
            return Math.round(value).toLocaleString('en-US');
        }

        // Update slider background
        function updateSliderBackground(slider) {
            const min = parseFloat(slider.min);
            const max = parseFloat(slider.max);
            const val = parseFloat(slider.value);
            const progress = ((val - min) / (max - min)) * 100;
            slider.style.setProperty('--progress', progress + '%');
        }

        // Calculate and update all metrics
        function updateCalculations() {
            const seatedTractors = parseInt(document.getElementById('tractorSlider').value);
            const overhead = parseCurrency(document.getElementById('overheadInput').value);
            const variableCost = parseCurrency(document.getElementById('variableInput').value);
            
            // Rates slider: 0 = $2.17 (current), 100 = $2.45 (target)
            const ratesSliderValue = parseFloat(document.getElementById('ratesSlider').value);
            const ratePerMile = 2.17 + (ratesSliderValue / 100) * 0.28; // 0->$2.17, 100->$2.45
            
            // Empty miles slider: 0 = 18% (current), 80 = 10% (target)
            const emptySliderValue = parseFloat(document.getElementById('emptyMilesSlider').value);
            const emptyPercent = 18 - (emptySliderValue / 80) * 8; // 0->18%, 80->10%
            
            // Maintenance slider: 0 = $0.40 (current), 100 = $0.18 (target)
            const maintSliderValue = parseFloat(document.getElementById('maintenanceSlider').value);
            const maintPerMile = 0.40 - (maintSliderValue / 100) * 0.22; // 0->$0.40, 100->$0.18
            
            // Insurance slider: 0 = $0.22 (current), 100 = $0.11 (target)
            const insuranceSliderValue = parseFloat(document.getElementById('insuranceSlider').value);
            const insurancePerMile = 0.22 - (insuranceSliderValue / 100) * 0.11; // 0->$0.22, 100->$0.11
            
            // Current baseline calculations
            const currentTotalCost = overhead + variableCost;
            const currentProfit = currentStats.monthlyRevenue - currentTotalCost;
            const currentOR = (currentTotalCost / currentStats.monthlyRevenue) * 100;
            
            // Update current profit/loss display
            const currentProfitBox = document.getElementById('currentProfitBox');
            const currentProfitDisplay = document.getElementById('currentProfitLoss');
            currentProfitDisplay.textContent = formatCurrency(currentProfit);
            if (currentProfit >= 0) {
                currentProfitBox.classList.remove('loss');
                currentProfitBox.classList.add('profit');
            } else {
                currentProfitBox.classList.remove('profit');
                currentProfitBox.classList.add('loss');
            }
            
            // Derived metrics based on current inputs
            const revenuePerTractor = currentStats.monthlyRevenue / currentStats.seatedTractors;
            const variableCostPerTractor = variableCost / currentStats.seatedTractors;
            const contributionMarginPerTractor = revenuePerTractor - variableCostPerTractor;
            
            const additionalTractors = seatedTractors - currentStats.seatedTractors;
            const tractorAddedRevenue = additionalTractors * revenuePerTractor;
            
            // Rates calculations (applies to loaded miles)
            const currentLoadedMiles = currentStats.totalMiles * (1 - currentStats.currentEmptyPercent / 100);
            const rateIncrease = ratePerMile - currentStats.currentRatePerMile;
            const rateAddedRevenue = currentLoadedMiles * rateIncrease;
            
            // Update rates display
            document.getElementById('ratePerMileDisplay').textContent = '$' + ratePerMile.toFixed(2);
            document.getElementById('rateMilesDisplay').textContent = formatMiles(currentLoadedMiles);
            document.getElementById('rateIncrease').textContent = '+$' + rateIncrease.toFixed(2);
            document.getElementById('rateRevenue').textContent = formatCurrency(rateAddedRevenue);
            
            // Empty miles calculations
            const currentEmptyMiles = currentStats.totalMiles * (currentStats.currentEmptyPercent / 100);
            const newEmptyMiles = currentStats.totalMiles * (emptyPercent / 100);
            const milesConverted = currentEmptyMiles - newEmptyMiles;
            const additionalRevenueFromMiles = milesConverted * revenuePerLoadedMile;
            
            // Maintenance calculations
            const currentMaintCost = currentStats.totalMiles * currentStats.currentMaintPerMile;
            const projectedMaintCost = currentStats.totalMiles * maintPerMile;
            const maintSavings = currentMaintCost - projectedMaintCost;
            
            // Insurance calculations
            const currentInsuranceCost = currentStats.totalMiles * currentStats.currentInsurancePerMile;
            const projectedInsuranceCost = currentStats.totalMiles * insurancePerMile;
            const insuranceSavings = currentInsuranceCost - projectedInsuranceCost;
            
            // Update empty miles display
            document.getElementById('emptyMilesPercent').textContent = emptyPercent.toFixed(1) + '%';
            document.getElementById('totalMilesDisplay').textContent = formatMiles(currentStats.totalMiles);
            document.getElementById('milesConverted').textContent = formatMiles(milesConverted);
            document.getElementById('additionalRevenue').textContent = formatCurrency(additionalRevenueFromMiles);
            
            // Update maintenance display
            document.getElementById('maintPerMileDisplay').textContent = '$' + maintPerMile.toFixed(2);
            document.getElementById('maintMilesDisplay').textContent = formatMiles(currentStats.totalMiles);
            document.getElementById('projectedMaintCost').textContent = formatCurrency(projectedMaintCost);
            document.getElementById('maintSavings').textContent = formatCurrency(maintSavings);
            
            // Update insurance display
            document.getElementById('insurancePerMileDisplay').textContent = '$' + insurancePerMile.toFixed(2);
            document.getElementById('insuranceMilesDisplay').textContent = formatMiles(currentStats.totalMiles);
            document.getElementById('projectedInsuranceCost').textContent = formatCurrency(projectedInsuranceCost);
            document.getElementById('insuranceSavings').textContent = formatCurrency(insuranceSavings);
            
            // Projected financials (combining all impacts)
            const projectedRevenueFromTractors = seatedTractors * revenuePerTractor;
            const projectedRevenue = projectedRevenueFromTractors + additionalRevenueFromMiles + rateAddedRevenue;
            const projectedVariableCost = seatedTractors * variableCostPerTractor;
            
            // Adjust for maintenance and insurance savings
            const totalSavings = maintSavings + insuranceSavings;
            const adjustedVariableCost = projectedVariableCost - totalSavings;
            const projectedTotalCost = overhead + adjustedVariableCost;
            const projectedOR = (projectedTotalCost / projectedRevenue) * 100;
            const orImprovement = currentOR - projectedOR;
            
            // Profit calculations
            const projectedProfitValue = projectedRevenue - projectedTotalCost;
            const profitImpact = projectedProfitValue - currentProfit;
            
            // Utilization
            const utilization = (seatedTractors / currentStats.totalTractors) * 100;

            // Update current OR display
            document.getElementById('currentOR').textContent = formatPercent(currentOR);

            // Update results panel
            document.getElementById('tractorCount').textContent = seatedTractors;
            document.getElementById('utilization').textContent = utilization.toFixed(1);
            document.getElementById('additionalTractors').textContent = '+' + additionalTractors;
            document.getElementById('tractorRevenue').textContent = formatCurrency(tractorAddedRevenue);
            document.getElementById('projectedOR').textContent = formatPercent(projectedOR);
            document.getElementById('orImprovement').textContent = orImprovement.toFixed(1) + ' pts';
            document.getElementById('profitImpact').textContent = formatCurrencyWithSign(profitImpact);
            document.getElementById('projectedRevenue').textContent = formatCurrency(projectedRevenue);
            document.getElementById('projectedCost').textContent = formatCurrency(projectedTotalCost);
            document.getElementById('revenuePerTractor').textContent = formatCurrency(revenuePerTractor);
            document.getElementById('varCostPerTractor').textContent = formatCurrency(variableCostPerTractor);
            document.getElementById('contributionMargin').textContent = formatCurrency(contributionMarginPerTractor);
            
            // Update projected profit display
            const projectedProfitBox = document.getElementById('projectedProfitBox');
            const projectedProfitDisplay = document.getElementById('projectedProfit');
            projectedProfitDisplay.textContent = formatCurrency(projectedProfitValue);
            if (projectedProfitValue >= 0) {
                projectedProfitBox.classList.remove('loss');
                projectedProfitBox.classList.add('profit');
            } else {
                projectedProfitBox.classList.remove('profit');
                projectedProfitBox.classList.add('loss');
            }
        }

        // Initialize sliders
        const tractorSlider = document.getElementById('tractorSlider');
        const ratesSlider = document.getElementById('ratesSlider');
        const emptyMilesSlider = document.getElementById('emptyMilesSlider');
        const maintenanceSlider = document.getElementById('maintenanceSlider');
        const insuranceSlider = document.getElementById('insuranceSlider');
        
        updateSliderBackground(tractorSlider);
        updateSliderBackground(ratesSlider);
        updateSliderBackground(emptyMilesSlider);
        updateSliderBackground(maintenanceSlider);
        updateSliderBackground(insuranceSlider);

        tractorSlider.addEventListener('input', function() {
            updateSliderBackground(this);
            updateCalculations();
        });

        ratesSlider.addEventListener('input', function() {
            updateSliderBackground(this);
            updateCalculations();
        });

        emptyMilesSlider.addEventListener('input', function() {
            updateSliderBackground(this);
            updateCalculations();
        });

        maintenanceSlider.addEventListener('input', function() {
            updateSliderBackground(this);
            updateCalculations();
        });

        insuranceSlider.addEventListener('input', function() {
            updateSliderBackground(this);
            updateCalculations();
        });

        // Input field handlers
        const overheadInput = document.getElementById('overheadInput');
        const variableInput = document.getElementById('variableInput');

        function formatInputOnBlur(input) {
            const value = parseCurrency(input.value);
            input.value = formatNumber(value);
            updateCalculations();
        }

        overheadInput.addEventListener('input', updateCalculations);
        variableInput.addEventListener('input', updateCalculations);

        overheadInput.addEventListener('blur', function() {
            formatInputOnBlur(this);
        });

        variableInput.addEventListener('blur', function() {
            formatInputOnBlur(this);
        });

        overheadInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') this.blur();
        });

        variableInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') this.blur();
        });

        // Initial calculation
        updateCalculations();
    </script>
</body>
</html>